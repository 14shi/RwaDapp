const MODE=typeof secrets!=='undefined'&&secrets.ENVIRONMENT?secrets.ENVIRONMENT:"test";const API_CONFIG={test:{spotify:{revenue:"mock"},patent:{revenue:"mock"},gpu:{revenue:"mock"}},production:{spotify:{revenue:"https://api.spotify.com/v1/analytics/tracks"},patent:{revenue:"https://api.uspto.gov/licensing"},gpu:{revenue:"https://gpu-marketplace.example.com/earnings"}}};function generateMockRevenue(externalId,lastUpdate){const currentDay=Math.floor(Date.now()/86400000);const seed=currentDay+parseInt(externalId||"0");const randomFactor=(seed%100)/1000;const revenueETH=randomFactor;return Math.floor(revenueETH*1e18)}function convertUSDtoWei(usdAmount){const ethPrice=2000;const ethAmount=usdAmount/ethPrice;return Math.floor(ethAmount*1e18)}async function fetchSpotifyRevenue(externalId,lastUpdate){const config=API_CONFIG[MODE].spotify;if(MODE==="test"){return generateMockRevenue(externalId,lastUpdate)}else{try{const now=Date.now();const startDate=new Date(lastUpdate*1000).toISOString();const endDate=new Date(now).toISOString();const response=await Functions.makeHttpRequest({url:`${config.revenue}/${externalId}/revenue`,method:"GET",headers:{Authorization:secrets.SPOTIFY_API_TOKEN},params:{start_date:startDate,end_date:endDate}});if(response.error)return 0;const revenueUSD=response.data.total_revenue||0;return convertUSDtoWei(revenueUSD)}catch(error){return 0}}}async function fetchPatentRevenue(externalId,lastUpdate){const config=API_CONFIG[MODE].patent;if(MODE==="test"){return Math.floor(0.05*1e18)}else{try{const response=await Functions.makeHttpRequest({url:`${config.revenue}/${externalId}/earnings`,method:"GET",headers:{"X-API-Key":secrets.USPTO_API_KEY}});if(response.error)return 0;const revenueUSD=response.data.licensing_revenue||0;return convertUSDtoWei(revenueUSD)}catch(error){return 0}}}async function fetchGPURevenue(externalId,lastUpdate){const config=API_CONFIG[MODE].gpu;if(MODE==="test"){return generateMockRevenue(externalId,lastUpdate)}else{try{const response=await Functions.makeHttpRequest({url:`${config.revenue}/${externalId}`,method:"GET",headers:{"X-API-Key":secrets.GPU_API_KEY},params:{since:lastUpdate}});if(response.error)return 0;return parseInt(response.data.earnings_wei||"0")}catch(error){return 0}}}async function fetchRevenue(assetType,externalId,lastUpdate){let revenueWei=0;switch(parseInt(assetType)){case 0:revenueWei=await fetchSpotifyRevenue(externalId,lastUpdate);break;case 1:revenueWei=await fetchPatentRevenue(externalId,lastUpdate);break;case 2:revenueWei=await fetchGPURevenue(externalId,lastUpdate);break;default:revenueWei=0}return revenueWei}const assetType=parseInt(args[0]);const externalId=args[1];const lastUpdate=parseInt(args[2]||0);const revenueWei=await fetchRevenue(assetType,externalId,lastUpdate);return Functions.encodeUint256(revenueWei);